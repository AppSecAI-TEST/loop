require channels

# counter channel:
do_stuff(msg) =>
  -1        : @shutdown
  *         : mem[@count] = mem[@count] + 1
  where
    mem     : channel_memory().print()


main ->
  channel(@printer, do_stuff, { @serialize : true }),
  @printer.send(i) for i in [1..10],
  @printer.send(-1)
